### zk与eureka对比

--

zookeeper与eureka同作为经典的注册中心组件，在选型时会被经常来出来进行对比，本文将从使用方式和实现原理上对两者进行对比分析。

#### 原理对比

注册中心一般需要哪些功能呢：服务发现，服务注册，服务通知；高可用及数据一致性

**zookeeper**

zk通过文件系统创建节点+客户端watch的方式来实现注册中心的功能，对于同意服务，当有新的provider注册时，会在特定zk目录下创建临时节点，并通知其他zk节点，consumer可以从注册中心查找指定目录的providers并watch特定目录，以监控服务提供者们的运行状况.

创建临时节点有一个好处，当provider进程宕机时，临时节点会被删除并通知consumer；此外，consumer可以没30s从zk中同步一次服务列表.

**eureka**

eureka通过eureka-client加eureka-server来实现注册中心的功能，服务启动时，通过client向eureka注册来实现服务注册；通过client向eureka请求服务列表来实现服务发现及订阅；client每30秒会发一次心跳，如果90秒都没有心跳，会认为服务不可用，然后从列表中删除。client每30秒同步一次可用服务列表。当服务关闭时，需要调用shutdown方法通知eureka-server服务关闭(***无法实时通知client服务更改？***)

通过打开开关，可以让eureka server处于保护状态，主要是用于某eureka server由于网络或其他原因，导致接收不到其他微服务的心跳，此时不能盲目的将其他微服务从服务列表中删除。 具体规则：如果一段时间内，85%的服务都没有发送心跳，则此server进入保护状态，此状态下，可以正常接受注册，可以正常提供查询服务，但是不与其他server同步信息，也不会通知订阅它的客户端，这样就不会误杀其他微服务

#### CAP保障

**zookeeper保障CP**

zookeeper能够保证最终一致性，即弱一致性，无法保证可用性，当zk节点之间网络不通时，连接到更少节点的客户端不能进行写操作，也就是服务暂时不可用，因此zk更偏向于CP

>**注:zk中的C也不是强一致性，而是最终一致性，因为连接到follower节点的客户读取到的也非最新数据**

**eureka保障AP**

在eureka节点网络不通时，可以向节点写入数据，当时数据不会同步到其他节点，因此，eureka可以认为是AP的

#### 数据同步方法

**zookeeper**

**eureka**

#### 选举方法

**zookeeper**

**eureka**
