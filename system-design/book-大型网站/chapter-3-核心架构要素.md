## 大型网站核心架构要素

软件架构的具体定义： 关于软件整体结构与具体组件的抽象描述，用于指导大型软件系统各个方面的设计。

一般来讲，软件系统的设计除了要关注业务功能的实现外，还需要关注性能、可用性、伸缩性、扩展性以及安全性5个核心要素。架构师在设计的过程中要平衡这5个要素之间的关系以实现需求和架构目标。也可以通过考察这些架构的核心要素来衡量一个软件系统的优劣，判断其是否满足期望，

### 性能

性能是大型网站架构设计中要考虑的重要因素，大多数情况下，用户都无法容忍一个响应缓慢的网站。在面对大量用户、海量数据时，对性能的考量尤为重要。

**性能优化**

一般来讲，性能优化可以分为三个部分：

* 网站前端的优化

通常有浏览器缓存、cdn加速、数据压缩等手段；此外，客户端还可以通过合并http请求、动静内容分离等手段提高前端的性能。

* 应用服务器的优化

	应用服务器承载着整个系统的主要业务逻辑，通常是性能问题最多的部分，同时也有比较多的优化手段。
	* 缓存：可以使用本地缓存和分布式缓存来降低数据库读写，提高性能
	* 集群：使用服务集群及合适的负载均衡算法，降低单台机器的QPS
	* 异步：使用消息队列中间件，将处理流程异步化，提升响应速度
	* 多线程：善用服务器资源，在代码层面使用合理的多线程/内存管理手段，提升系统性能
	
* 存储系统的优化

存储系统的优化一方面可以使用索引、SQL优化、分库分表等成熟的关系数据库手段，并一方面可以引入NoSQL数据库，优化存储系统的访问性能。

**性能指标**

不同角色对网络系统的性能感知并不一样。对于用户而言，性能是从发出请求到看到响应的时间；对于服务端开发人员而言，性能是从请求进入系统到系统返回响应的时间；综合而言，性能优化是指通过提升系统全链路的处理速度来提升用户体验。进一步，性能优化不仅要保证系统能服务当前的用户体量，还要保证系统能够容纳可预见的未来随着业务发展而不断增长的用户量。

衡量网站常用的指标有响应时间、TPS、系统性能计数器等，这些指标也是系统重要的监控参数。

### 可用性

网站可用性的衡量标准通常用网站的总可用时间除以总时间，大型知名网站的可用性基本可以达到四个九，即99.99%。

网站可用性的主要手段是冗余，应用和数据通常部署在多个服务器上，某一个服务器宕机并不影响整个系统对外提供的服务。

除了对运行时环境进行保障，还需要对软件的开发过程进行质量保证，通过<b>预发布验证、灰度发布、自动化测试、自动化发布</b>等手段，减少将故障引入线上环境的可能。

> 关注开发过程的质量保证流程，运行过程的监控

### 伸缩性

伸缩性主要是指系统可以根据业务量方便的进行扩容、缩容。当用户量不断增加时，可以通过增加服务器提升系统性能；当业务量减少时，可以通过下线部分机器节省服务器资源。

对于应用服务器，只需要保证服务本身是无状态的（不保存数据），就可以通过合适的负载均衡算法实现可伸缩。

传统的关系数据库通常很难实现可伸缩，可以通过中间件在数据库之外实现可伸缩，比如通过路由分区等手段将部署有多个数据库服务器组成一个集群。

主流的NoSQL数据库及相关的分布式数据库基本上都是为大数据而生，通常对可伸缩性的支持都较好。

> 在应用服务器的设计实现时，考虑服务的无状态化，考虑合适的分库分表策略

### 扩展性

在业务不断发展的过程中，如何方便快速的响应需求变化，是可扩展架构的主要目的。

通常一个系统的用户基数越大，功能越复杂，添加新功能或者修改原有功能的难度就越大。可扩展主要依靠事件驱动架构和分布式服务。

事件驱动架构是指通过消息队列对系统的不同组件、组件的不同模块进行解耦合，使之可以透明的增加新的生产者或消费者。

分布式服务将业务和可服用服务分离开，增加新的调用者对业务透明。

>个人理解即通过mq和rpc对系统解耦，来实现可扩展

### 安全性

保障敏感数据不被窃取，保障网站不受恶意访问和攻击的影响。总而言之，对于现在和潜在的各种攻击手段，系统能有相应的应对策略。


### 小结

在大型网站系统的架构中，应综合考虑性能、可用性、伸缩性、扩展性、安全性五个核心要素。了解系统在实现5个核心要素时的对应方法。
