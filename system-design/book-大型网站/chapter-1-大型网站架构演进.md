## 大型网站架构演进

随着互联网、移动互联网的快速发展，网站/应用系统的规模也在急速增长，对系统进行合理的架构设计，使其能够服务海量客户及数据。

### 对大型网站的技术要求

成熟的大型应用系统需要有以下几个特点

* 高可用
* 高性能
* 易扩展
* 易维护
* 可伸缩
* 安全性

### 为什么有这些要求

* 高可用

如谷歌百度淘宝微信等应用，每天0-24点都会有大量用户使用，任何时间的不可用都会造成大规模影响

* 高性能

如淘宝、京东双十一，通常一瞬间会有大量流量涌入，系统必须保证高性能，以避免流量洪峰将其冲垮

* 易扩展

互联网应用通常会不断迭代以改善现有功能或者增加新功能，易扩展性保证系统能够方便的添加新的功能或模块

* 易维护

软件系统的通用要求

* 可伸缩

系统规模应该是可伸缩的，以应对不同的用户规模

* 安全性

应用安全，抵挡各种恶意攻击；数据安全，避免数据泄露

### 大型网站系统的发展过程中如何解决这些要求

网站系统的发展由简到繁，以解决架构设计中的各种问题。

#### 初始LAMP

 最早的网站部署多采用LAMP（linux+apache+mysql+php）,应用服务、文件服务和数据库在同一台机器上

#### 应用、文件、存储系统分离

应用服务，文件服务及数据库单独部署，提升性能的同时避免相互影响。

#### 缓存

随着访问增大，开始增加缓存以提升性能，避免所有访问压力都直达数据库。

**缓存设计**

* 缓存策略：缓存哪些数据；失效/过期策略；多级缓存设计
* 缓存一致性如何保证
* 如何避免缓存穿透（大量缓存同时失效，访问穿透到DB，DB宕机）
* 内存缓存 or 分布式缓存
* 如果是分布式缓存，中间件选型(redis/tair/memcache)，中间件本身的高可用、高性能及一致性

#### 数据库读写分离

大多数互联网场景遵循读多写少；数据库写成本远高于读。进行读写分离以提升性能。

**读写分离设计**

* 主从同步延迟保障
* 应用服务读到从数据库的过期数据时，何种策略兜底
* 数据库服务的高可用、高性能保障

#### 应用拆分

当系统越来越庞大时，系统的扩展和维护成本将迅速增加。此时，可以将系统各个模块拆分为独立的服务，单独部署、运行。例如电商系统可以分为商家服务、商品服务、用户中心及支付服务等。

**如何规划应用的拆分**

应用拆分是架构设计的重点也是难点之一，对应用的拆分一定是基于业务的。因此，架构师首先应该对业务本身有足够了解，还需要对业务的发展有一定规划、对拆分后的系统容量有一定预估。一方面，拆分并不是一蹴而就的，而是随着业务发展不断演进的；另一方面，拆分后的系统要在一定时间内能够支撑业务的发展。

#### 分布式、集群部署

对系统各模块进行拆分后，可以将服务独立部署，每个服务可以部署多个实例，每个实例可以优雅上线、下线。以满足高可用、可伸缩的需求

**大型分布式应用的设计**

大型分布式应用通常由数百个甚至数千个服务实例组成，如何进行服务治理是大型分布式应用的难点。

* 服务调用链治理
	* 服务调用关系梳理
	* 对外依赖考虑降级（自动/手动）、熔断
* 服务监控、报警
* 服务上线
	* 灰度上线保障
	* 全量上线
* 单个服务实例下线不影响用户体验

#### CDN与反向代理

互联网用户遍布全球，不同国家甚至同一国家不同地区的网络情况各不相同。使用CDN，用户可以通过访问距离自己最近的机房获取数据。请求达到中心机房后，反向代理也可以将缓存的数据直接返回给用户。

**CDN与反向代理的设计**

* CDN存储哪些数据
* 数据中心灾备设计

#### 分布式存储系统

除了传统的关系型数据库之外，还可以使用不同的存储系统来满足各种场景。

* 传统数据库采用分库、分表提升容量
* 使用ES满足复杂的查询需求
* 使用Nosql满足轻量级数据存储
* 使用HDFS等满足海量数据存储、处理

**存储系统设计**

存储系统设计的难点在于，如何根据业务场景对存储系统进行合理选型。

### 架构误区

* 一开始就按照超大规模系统进行设计

应用系统应遵循渐进式发展，各系统具体需求不同，设计的具体方法也不同，不能一上来就照搬已有的系统设计

* 试图用技术手段解决所有问题

从成本、可行性等多方面思考，技术手段、业务手段哪个更为合理，性价比更高

